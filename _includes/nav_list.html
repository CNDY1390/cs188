{%- comment -%} Check nav_exclude, but ignore it if node matches current language {%- endcomment -%}
{%- assign current_lang_check = "en" -%}
{%- if page.url contains "/zh-cn/" -%}
  {%- assign current_lang_check = "zh-cn" -%}
{%- elsif page.url contains "/es/" -%}
  {%- assign current_lang_check = "es" -%}
{%- endif -%}
{%- assign node_lang_check = "en" -%}
{%- if include.node.url contains "/zh-cn/" -%}
  {%- assign node_lang_check = "zh-cn" -%}
{%- elsif include.node.url contains "/es/" -%}
  {%- assign node_lang_check = "es" -%}
{%- endif -%}
{%- assign should_exclude = false -%}
{%- if include.node.nav_exclude and node_lang_check != current_lang_check -%}
  {%- assign should_exclude = true -%}
{%- endif -%}
{%- unless should_exclude or include.node.released == false and
jekyll.environment != "debug" -%} {%- assign include.node_url_size =
include.node.url | size -%} {%- assign url_size = include.node.url | size -%}
{%- assign prefix = page.url | slice: 0, url_size -%}
<li class="nav-list-item {% if include.node.url == prefix %} active{% endif %}">
  <a
    href="{{ include.node.url | relative_url }}"
    class="nav-list-link{% if page.url == include.node.url %} active{% endif %}"
    >{%- comment -%} Display Chinese title for Chinese pages {%- endcomment -%}
    {%- assign current_lang = "en" -%}
    {%- if page.url contains "/zh-cn/" -%}
      {%- assign current_lang = "zh-cn" -%}
    {%- elsif page.url contains "/es/" -%}
      {%- assign current_lang = "es" -%}
    {%- endif -%}
    {%- if current_lang == "zh-cn" -%}
      {%- if include.node.title == "2. CSPs" -%}2. 约束满足问题
      {%- elsif include.node.title == "4. MDPs" -%}4. 马尔可夫决策过程
      {%- elsif include.node.title == "5. RL" -%}5. 强化学习
      {%- elsif include.node.title == "6. Bayes Nets" -%}6. 贝叶斯网络
      {%- elsif include.node.title == "8. HMMs" -%}8. 隐马尔可夫模型
      {%- elsif include.node.title == "9. ML" -%}9. 机器学习
      {%- elsif include.node.title == "1. Search" -%}1. 搜索
      {%- elsif include.node.title == "3. Games" -%}3. 博弈
      {%- else -%}{{ include.node.title }}{%- endif -%}
    {%- else -%}{{ include.node.title }}{%- endif -%}</a
  >
  {%- if include.node.has_children and include.depth <= site.max_nav_depth -%}
  {%- comment -%} Get children - filter by language FIRST, then by parent {%- endcomment -%}
  {%- assign current_lang = "en" -%}
  {%- if page.url contains "/zh-cn/" -%}
    {%- assign current_lang = "zh-cn" -%}
  {%- elsif page.url contains "/es/" -%}
    {%- assign current_lang = "es" -%}
  {%- endif -%}
  {%- comment -%} Filter all pages by language first {%- endcomment -%}
  {%- assign all_pages = site.html_pages | where_exp: "item", "item.title != nil" -%}
  {%- assign filtered_pages = "" | split: "X" -%}
  {%- for item in all_pages -%}
    {%- assign item_lang = "en" -%}
    {%- if item.url contains "/zh-cn/" -%}
      {%- assign item_lang = "zh-cn" -%}
    {%- elsif item.url contains "/es/" -%}
      {%- assign item_lang = "es" -%}
    {%- endif -%}
    {%- if current_lang == item_lang -%}
      {%- assign filtered_pages = filtered_pages | push: item -%}
    {%- endif -%}
  {%- endfor -%}
  {%- comment -%} Then filter by parent from language-filtered pages {%- endcomment -%}
  {%- if include.node.child_nav_order == 'desc' -%} {%- assign children_list =
  filtered_pages | where: "parent", include.node.title | reverse -%} {%- else -%}
  {%- assign children_list = filtered_pages | where: "parent", include.node.title
  -%} {%- endif -%}
  {%- assign filtered_children = children_list -%}
  {%- assign children_depth = include.depth | plus:1 -%}
  <ul class="nav-list child">
    {%- for child in filtered_children -%} {%- include nav_list.html node=child
    depth=children_depth -%} {%- endfor -%}
  </ul>
  {%- endif -%} {%- endunless -%}
</li>
