<!-- Minimal Language Toggle -->
<div class="language-toggle">
  <div style="position: relative;">
    {%- assign current_lang = "en" -%}
    {%- if page.url contains "/zh-cn/" -%}
      {%- assign current_lang = "zh-cn" -%}
    {%- elsif page.url contains "/es/" -%}
      {%- assign current_lang = "es" -%}
    {%- endif -%}
    
    {%- assign current_lang_obj = site.languages | where: "code", current_lang | first -%}
    {%- if current_lang_obj == nil -%}
      {%- assign current_lang_obj = site.languages | where: "code", "en" | first -%}
    {%- endif -%}
    
    <button onclick="document.getElementById('lang-menu').style.display = document.getElementById('lang-menu').style.display === 'block' ? 'none' : 'block'" class="lang-btn">
      {{ current_lang_obj.flag }} {{ current_lang_obj.name }}
    </button>
    
    <div id="lang-menu" class="lang-menu" style="display: none;">
      {%- for lang in site.languages -%}
        {%- if lang.code != current_lang -%}
        <div onclick="switchLang({{ lang.code | jsonify }}, {{ lang.path | jsonify }})" class="lang-option">
          {{ lang.flag }} {{ lang.name }}
        </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</div>

<script>
window.switchLang = function(targetCode, targetPath) {
  var basePath = {{ site.baseurl | jsonify }} || '';
  if (basePath && basePath.charAt(basePath.length - 1) === '/') {
    basePath = basePath.slice(0, -1);
  }
  
  var path = window.location.pathname.replace(basePath, '');
  if (path.charAt(0) !== '/') path = '/' + path;
  
  // Remove current lang prefix
  var langs = [
    {%- for lang in site.languages -%}
    {code: {{ lang.code | jsonify }}, path: {{ lang.path | jsonify }}}{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ];
  
  for (var i = 0; i < langs.length; i++) {
    if (langs[i].path && path.indexOf('/' + langs[i].path + '/') === 0) {
      path = path.substring(langs[i].path.length + 1);
      break;
    }
  }
  
  // Add target lang prefix
  if (targetPath) {
    path = '/' + targetPath + path;
  }
  
  window.location.href = basePath + path;
};

// Close menu when clicking outside
document.addEventListener('click', function(e) {
  var menu = document.getElementById('lang-menu');
  var btn = document.querySelector('.lang-btn');
  if (menu && menu.style.display === 'block' && !menu.contains(e.target) && e.target !== btn) {
    menu.style.display = 'none';
  }
});
</script>

<style>
.language-toggle {
  position: fixed;
  top: 80px;
  right: 20px;
  z-index: 9999;
}
.lang-btn {
  padding: 8px 16px;
  background: var(--body-background-color, #fff);
  border: 1px solid var(--border-color, #eee);
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  color: var(--body-text-color, #333);
}
.lang-menu {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 5px;
  background: var(--body-background-color, #fff);
  border: 1px solid var(--border-color, #eee);
  border-radius: 6px;
  min-width: 150px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.lang-option {
  padding: 10px 16px;
  cursor: pointer;
  font-size: 14px;
  color: var(--body-text-color, #333);
}
.lang-option:hover {
  background: var(--sidebar-color, #f5f5f5);
}
@media (max-width: 768px) {
  .language-toggle {
    top: 60px;
    right: 10px;
  }
  .lang-btn {
    padding: 6px 10px;
    font-size: 12px;
  }
}
</style>
