<!-- Minimal Language Toggle -->
<div class="language-toggle">
  <div style="position: relative;">
    {%- assign current_lang = "en" -%}
    {%- if page.url contains "/zh-cn/" -%}
      {%- assign current_lang = "zh-cn" -%}
    {%- elsif page.url contains "/es/" -%}
      {%- assign current_lang = "es" -%}
    {%- endif -%}
    
    {%- assign current_lang_obj = site.languages | where: "code", current_lang | first -%}
    {%- if current_lang_obj == nil -%}
      {%- assign current_lang_obj = site.languages | where: "code", "en" | first -%}
    {%- endif -%}
    
    <button onclick="var m=document.getElementById('lang-menu');m.style.display=m.style.display==='block'?'none':'block'" class="lang-btn">
      {{ current_lang_obj.flag }} {{ current_lang_obj.name }}
    </button>
    
    <div id="lang-menu" class="lang-menu" style="display: none;">
      {%- for lang in site.languages -%}
        {%- if lang.code != current_lang -%}
        <div onclick="switchLang('{{ lang.code }}','{{ lang.path }}')" class="lang-option">
          {{ lang.flag }} {{ lang.name }}
        </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</div>

<script>
function switchLang(targetCode, targetPath) {
  var basePath = '{{ site.baseurl }}' || '';
  if (basePath && basePath.charAt(basePath.length - 1) === '/') {
    basePath = basePath.slice(0, -1);
  }
  
  var path = window.location.pathname.replace(basePath, '');
  if (path.charAt(0) !== '/') path = '/' + path;
  
  var langPaths = {
    {%- for lang in site.languages -%}
    '{{ lang.code }}': '{{ lang.path }}'{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  };
  
  for (var code in langPaths) {
    var p = langPaths[code];
    if (p && path.indexOf('/' + p + '/') === 0) {
      path = path.substring(p.length + 1);
      break;
    }
  }
  
  if (targetPath && targetPath !== '') {
    path = '/' + targetPath + path;
  }
  
  window.location.href = basePath + path;
}

document.addEventListener('click', function(e) {
  var menu = document.getElementById('lang-menu');
  var btn = document.querySelector('.lang-btn');
  if (menu && menu.style.display === 'block' && !menu.contains(e.target) && e.target !== btn) {
    menu.style.display = 'none';
  }
});
</script>

<style>
.language-toggle {
  position: fixed;
  top: 80px;
  right: 20px;
  z-index: 9999;
}
.lang-btn {
  padding: 8px 16px;
  background: var(--body-background-color, #fff);
  border: 1px solid var(--border-color, #eee);
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  color: var(--body-text-color, #333);
}
.lang-menu {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 5px;
  background: var(--body-background-color, #fff);
  border: 1px solid var(--border-color, #eee);
  border-radius: 6px;
  min-width: 150px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.lang-option {
  padding: 10px 16px;
  cursor: pointer;
  font-size: 14px;
  color: var(--body-text-color, #333);
}
.lang-option:hover {
  background: var(--sidebar-color, #f5f5f5);
}
@media (max-width: 768px) {
  .language-toggle {
    top: 60px;
    right: 10px;
  }
  .lang-btn {
    padding: 6px 10px;
    font-size: 12px;
  }
}
</style>
