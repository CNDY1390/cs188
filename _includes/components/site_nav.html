{%- comment -%} 
Override Just the Docs components/site_nav.html with language filtering
This file is called by sidebar.html (or default layout) to generate navigation

问题：page.url 在 includes 中不可靠（显示 /404.html），必须使用客户端检测
解决方案：使用客户端 JavaScript 检测语言并过滤导航
{%- endcomment -%}

{%- comment -%} 先渲染所有页面，由客户端 JavaScript 过滤 {%- endcomment -%}
{% include nav.html pages=site.html_pages key=nil %}

{%- comment -%} 客户端语言检测和过滤 {%- endcomment -%}
<script>
(function() {
  function getLang(path) {
    if (path.indexOf('/zh-cn/') !== -1) return 'zh-cn';
    if (path.indexOf('/es/') !== -1) return 'es';
    return 'en';
  }
  
  function filterNav() {
    var currentLang = getLang(window.location.pathname);
    var items = document.querySelectorAll('.nav-list > .nav-list-item');
    
    for (var i = 0; i < items.length; i++) {
      var item = items[i];
      var link = item.querySelector('.nav-list-link');
      if (!link) continue;
      var href = link.getAttribute('href');
      if (!href || href === '#') continue;
      var itemLang = getLang(href);
      if (itemLang !== currentLang) {
        item.style.display = 'none';
      } else {
        var childList = item.querySelector('ul.nav-list');
        if (childList) {
          var childItems = childList.querySelectorAll('.nav-list-item');
          for (var j = 0; j < childItems.length; j++) {
            var childLink = childItems[j].querySelector('.nav-list-link');
            if (childLink) {
              var childHref = childLink.getAttribute('href');
              if (childHref && childHref !== '#') {
                var childLang = getLang(childHref);
                if (childLang !== currentLang) {
                  childItems[j].style.display = 'none';
                }
              }
            }
          }
        }
      }
    }
    
    var expanders = document.querySelectorAll('.nav-list-expander');
    for (var k = 0; k < expanders.length; k++) {
      var exp = expanders[k];
      exp.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        var listItem = e.target.closest('.nav-list-item');
        if (!listItem) return;
        var childList = listItem.querySelector('ul.nav-list');
        if (!childList) return;
        var isHidden = window.getComputedStyle(childList).display === 'none';
        childList.style.display = isHidden ? 'block' : 'none';
        listItem.classList.toggle('active', isHidden);
      });
    }
  }
  
  function run() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(filterNav, 200);
      });
    } else {
      setTimeout(filterNav, 200);
    }
  }
  
  run();
})();
</script>


