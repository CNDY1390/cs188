{%- comment -%} 
Custom children_nav.html with language filtering
Override the default Just the Docs children_nav.html to filter by language

问题：page.url 在 includes 中不可靠，必须使用客户端过滤
解决方案：先渲染所有子页面，由客户端 JavaScript 过滤
{%- endcomment -%}

{%- if page.has_children == false or page.has_toc == false -%}
  {%- assign nav_children = "" | split: "" -%}
{%- else -%}
  {%- comment -%} Get all pages and filter by parent (language filtering done by client) {%- endcomment -%}
  {%- assign all_pages = site[page.collection] | default: site.html_pages | where_exp: "item", "item.title != nil" -%}
  {%- comment -%} Group pages by parent {%- endcomment -%}
  {%- assign nav_parenthood = all_pages | group_by: "parent" -%}
  {%- assign nav_parent_group = nav_parenthood | where_exp: "item", "item.name == page.title" | first -%}
  {%- if nav_parent_group -%}
    {%- assign nav_children = nav_parent_group.items -%}
  {%- else -%}
    {%- assign nav_children = "" | split: "" -%}
  {%- endif -%}
{%- endif -%}

{%- if nav_children.size >= 1 -%}
  {%- comment -%} Sort by nav_order (same logic as nav.html) {%- endcomment -%}
  {%- assign string_ordered_pages = nav_children | where_exp:"item", "item.nav_order == nil" -%}
  {%- assign nav_ordered_pages = nav_children | where_exp:"item", "item.nav_order != nil" -%}
  {%- assign nav_ordered_groups = nav_ordered_pages | group_by_exp:"item", "item.nav_order | jsonify | slice: 0" -%}
  {%- assign number_ordered_pages = "" | split:"X" -%}
  {%- for group in nav_ordered_groups -%}
    {%- if group.name == '"' -%}
      {%- assign string_ordered_pages = string_ordered_pages | concat: group.items -%}
    {%- else -%}
      {%- assign number_ordered_pages = number_ordered_pages | concat: group.items -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign sorted_number_ordered_pages = number_ordered_pages | sort:"nav_order" -%}
  {%- assign string_ordered_groups = string_ordered_pages | group_by_exp:"item", "item.nav_order | default: item.title | append:''" -%}
  {%- if site.nav_sort == 'case_insensitive' -%}
    {%- assign sorted_string_ordered_groups = string_ordered_groups | sort_natural:"name" -%}
  {%- else -%}
    {%- assign sorted_string_ordered_groups = string_ordered_groups | sort:"name" -%}
  {%- endif -%}
  {%- assign sorted_string_ordered_pages = "" | split:"X" -%}
  {%- for group in sorted_string_ordered_groups -%}
    {%- assign sorted_string_ordered_pages = sorted_string_ordered_pages | concat: group.items -%}
  {%- endfor -%}
  {%- assign nav_children = sorted_number_ordered_pages | concat: sorted_string_ordered_pages -%}
  {%- if page.child_nav_order == 'desc' or page.child_nav_order == 'reversed' -%}
    {%- assign nav_children = nav_children | reverse -%}
  {%- endif -%}

* * *

{% for nav_child in nav_children %}*   [{{ nav_child.title }}]({{ nav_child.url | relative_url }}){% if nav_child.summary %} - {{ nav_child.summary }}{% endif %}
{% endfor %}

{%- endif -%}

